<%- include('../partials/header') %>

<main>
    <section class="section">
        <div class="container admin-container">
            <div class="admin-header">
                <h1 class="section-title" style="margin: 0;">Manage Coupons</h1>
            </div>
            
            <% if (typeof query !== 'undefined' && query.success) { %>
            <div class="success-message"><%= query.success %></div>
            <% } %>
            <% if (typeof query !== 'undefined' && query.error) { %>
            <div class="error-message"><%= query.error %></div>
            <% } %>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem;">Add New Coupon</h2>
                    <form action="/admin/coupons/add" method="POST">
                        <div class="form-group">
                            <label>Coupon Code</label>
                            <input type="text" name="code" required style="text-transform: uppercase;">
                        </div>
                        <div class="form-group">
                            <label>Discount Type</label>
                            <select name="discountType" required>
                                <option value="percentage">Percentage</option>
                                <option value="fixed">Fixed Amount</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Discount Value</label>
                            <input type="number" name="discountValue" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label>Minimum Purchase ($)</label>
                            <input type="number" name="minPurchase" step="0.01" min="0" value="0">
                        </div>
                        <div class="form-group">
                            <label>Maximum Discount ($) - Optional</label>
                            <input type="number" name="maxDiscount" step="0.01" min="0">
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label>Valid From</label>
                                <input type="datetime-local" name="validFrom" required>
                            </div>
                            <div class="form-group">
                                <label>Valid Until</label>
                                <input type="datetime-local" name="validUntil" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Usage Limit - Optional</label>
                            <input type="number" name="usageLimit" min="1" placeholder="Leave empty for unlimited">
                        </div>
                        <button type="submit" class="btn btn-add-cart" style="width: 100%;">Add Coupon</button>
                    </form>
                </div>
                
                <div style="background: var(--white); padding: 2rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem;">Existing Coupons</h2>
                    <% if (coupons && coupons.length > 0) { %>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <% coupons.forEach(coupon => { %>
                        <div style="padding: 1rem; border: 2px solid var(--border-color); border-radius: 5px;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <strong style="font-size: 1.2rem; color: var(--secondary-color);"><%= coupon.code %></strong>
                                <span style="<%= coupon.isValid() ? 'color: #4caf50;' : 'color: #f44336;' %>">
                                    <%= coupon.isValid() ? 'Active' : 'Inactive' %>
                                </span>
                            </div>
                            <p style="color: var(--text-light); margin-bottom: 0.5rem;">
                                <%= coupon.discountType === 'percentage' ? coupon.discountValue + '%' : '$' + coupon.discountValue %> off
                                <% if (coupon.minPurchase > 0) { %>
                                (Min: $<%= coupon.minPurchase %>)
                                <% } %>
                            </p>
                            <p style="color: var(--text-light); font-size: 0.9rem;">
                                Valid: <%= new Date(coupon.validFrom).toLocaleDateString() %> - <%= new Date(coupon.validUntil).toLocaleDateString() %>
                            </p>
                            <% if (coupon.usageLimit) { %>
                            <p style="color: var(--text-light); font-size: 0.9rem;">
                                Used: <%= coupon.usedCount %> / <%= coupon.usageLimit %>
                            </p>
                            <% } %>
                        </div>
                        <% }); %>
                    </div>
                    <% } else { %>
                    <p style="text-align: center; padding: 2rem; color: var(--text-light);">No coupons created yet.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
</main>

<%- include('../partials/footer') %>

