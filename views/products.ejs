<%- include('partials/header') %>

    <main>
        <section class="section">
            <div class="container">
                <h1 class="section-title">Our Products</h1>

                <div style="display: flex; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap; align-items: center;">
                    <div>
                        <label for="category-filter" style="margin-right: 0.5rem;">Category:</label>
                        <select id="category-filter" onchange="filterProducts()" style="padding: 0.5rem; border-radius: 5px; border: 2px solid var(--border-color);">
                        <option value="">All Categories</option>
                        <option value="Men" <%= currentCategory === 'Men' ? 'selected' : '' %>>Men</option>
                        <option value="Women" <%= currentCategory === 'Women' ? 'selected' : '' %>>Women</option>
                        <option value="Kids" <%= currentCategory === 'Kids' ? 'selected' : '' %>>Kids</option>
                        <option value="Accessories" <%= currentCategory === 'Accessories' ? 'selected' : '' %>>Accessories</option>
                    </select>
                    </div>

                    <div>
                        <label for="sort-filter" style="margin-right: 0.5rem;">Sort by:</label>
                        <select id="sort-filter" onchange="filterProducts()" style="padding: 0.5rem; border-radius: 5px; border: 2px solid var(--border-color);">
                        <option value="newest" <%= sortOption === 'newest' ? 'selected' : '' %>>Newest</option>
                        <option value="price-low" <%= sortOption === 'price-low' ? 'selected' : '' %>>Price: Low to High</option>
                        <option value="price-high" <%= sortOption === 'price-high' ? 'selected' : '' %>>Price: High to Low</option>
                    </select>
                    </div>

                    <div style="flex: 1;">
                        <input type="text" id="search-input" placeholder="Search products..." value="<%= searchQuery %>" style="width: 100%; max-width: 400px; padding: 0.5rem; border-radius: 5px; border: 2px solid var(--border-color);">
                    </div>
                </div>

                <% if (products && products.length > 0) { %>
                    <div class="product-grid">
                        <% products.forEach(product => { %>
                            <div class="product-card" onclick="window.location.href='/products/<%= product._id %>'">
                                <img src="<%= product.images && product.images[0] ? product.images[0] : '/images/p1.jpeg' %>" alt="<%= product.name %>" class="product-image">
                                <div class="product-info">
                                    <h3 class="product-name">
                                        <%= product.name %>
                                    </h3>
                                    <p style="color: var(--text-light); margin-bottom: 0.5rem;">
                                        <%= product.category %>
                                    </p>
                                    <div class="product-price">
                                        Rs
                                        <%= product.price.toFixed(2) %>
                                            <% if (product.originalPrice && product.originalPrice > product.price) { %>
                                                <span class="original">Rs<%= product.originalPrice.toFixed(2) %></span>
                                                <% } %>
                                    </div>
                                    <div class="product-actions">
                                        <button class="btn btn-add-cart" onclick="event.stopPropagation(); addToCart('<%= product._id %>')">Add to Cart</button>
                                        <button class="btn btn-wishlist" onclick="event.stopPropagation(); addToWishlist('<%= product._id %>')">â™¡</button>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                    </div>
                    <% } else { %>
                        <div style="text-align: center; padding: 3rem;">
                            <p style="font-size: 1.2rem; color: var(--text-light);">No products found.</p>
                        </div>
                        <% } %>
            </div>
        </section>
    </main>

    <script>
        function filterProducts() {
            const category = document.getElementById('category-filter').value;
            const sort = document.getElementById('sort-filter').value;
            const search = document.getElementById('search-input').value;

            let url = '/products?';
            if (category) url += 'category=' + category + '&';
            if (sort) url += 'sort=' + sort + '&';
            if (search) url += 'search=' + encodeURIComponent(search);

            window.location.href = url;
        }

        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                filterProducts();
            }
        });
    </script>

    <%- include('partials/footer') %>